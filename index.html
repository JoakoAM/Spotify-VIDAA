<!DOCTYPE html>
<html lang="es">
<head>
  <meta charset="UTF-8">
  <title>Mini Spotify</title>
  <link rel="stylesheet" href="style.css">
</head>
<body>
  <h1>Mini Spotify con Player</h1>

  <div id="login-section">
    <a href="https://spotifyvidaa-backend.onrender.com/login">
      <button>Conectar con Spotify</button>
    </a>
  </div>

  <div id="player-section" style="display:none;">
    <p id="current-track">Canción actual: -</p>
    <button onclick="play()">▶️ Play</button>
    <button onclick="pause()">⏸ Pause</button>
  </div>

  <!-- Define el callback global ANTES de cargar el SDK -->
  <script>
    window.onSpotifyWebPlaybackSDKReady = () => {
      const token = localStorage.getItem("spotify_token");
      const player = new Spotify.Player({
        name: "Mini Spotify Web Player",
        getOAuthToken: cb => { cb(token); },
        volume: 0.8
      });

      player.addListener('ready', ({ device_id }) => {
        console.log('Ready with Device ID', device_id);
        document.getElementById("player-section").style.display = "block";
      });

      player.addListener('player_state_changed', state => {
        if (!state) return;
        const track = state.track_window.current_track;
        document.getElementById("current-track").textContent =
          `Canción actual: ${track.name} - ${track.artists.map(a => a.name).join(", ")}`;
      });

      player.connect();
      window.spotifyPlayer = player;
    };

    function play() { window.spotifyPlayer?.resume(); }
    function pause() { window.spotifyPlayer?.pause(); }
  </script>

  <!-- Carga el SDK DESPUÉS de definir el callback -->
  <script src="https://sdk.scdn.co/spotify-player.js"></script>
</body>
</html>
